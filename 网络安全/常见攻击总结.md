# Net Attack

---

## 层次分类

### 1. 物理链路层

#### 有线网络

- 物理攻击
  
  •网络电缆坏     •网络电缆环路（两端插入同一设备）
  
  •网络控制器坏 •两个硬件地址相同的网络控制器

- Spoofing : ARP Spoofing =>ARP 中毒=> MITM 攻击=>在MITM中进行frame注入

- Sniffing : 本地网络, 以太网控制器设置为混杂模式
  
  缓解: Encryption, VLAN

- 广播目标洪泛 (连接本网络)

- 设置源地址可能会导致交换机混乱.

#### 无线网络

- wireless 无效的头将导致访问丢失或关联丢失(DoS)

- Jamming of signals (DoS):  故意干扰、阻塞或干扰授权的无线通信

- SSID discovery 泄露个人信息.
  
  关闭SSID广播, 使用加密或网络访问控制(NAC).

- Wardriving
  
  涉及攻击者在移动车辆的区域内移动时搜索存在漏洞的无线网络。他们使用硬件和软件来发现不安全的Wi-Fi网络，然后通过破解密码或解密路由器来获得未经授权的网络访问权限。然后，攻击者将易受攻击的网络位置记录在数字地图上，称为访问点映射，并可能与第三方应用程序和网站共享这些信息。
  
  缓解: 关闭SSID广播,使用加密或NAC

- 无线设备认证

- AP认证: 
  
  恶意 AP: 有效用户安装,有意或无意的向攻击者提供连接,绕过外围安全机制.
  
  缓解:
  
  - Scan for SSID (hard)
  
  - Scan for wireless traffic (hard)
  
  - NAC
  
  假冒 AP: 攻击者安装

#### 防御

- Wired Equivalent Privacy (WEP) ,使用40、128bit密钥生成流密钥.
  
  使用IV避免密钥流重用攻击.

- Wi-Fi Protected Access (WPA)
  
  - Home use
    
    认证服务器, 口令匹配则交换密钥, 使用共享密钥用作身份认证. 不同连接使用不同密钥.
  
  - enterprise
    
    移动设备与AP关联•移动设备与身份验证服务器进行身份验证（使用802.1X）•身份验证服务器向AP和移动设备分发密钥

- VLAN
  
  创建虚拟网络，根据硬件地址在每个VLAN之间隔离流量.
  
  - Static
  
  - Dynamic: 可能会被更改MAC地址所欺骗

- NAC
  
  通过对接入用户进行安全控制，提供“端到端”的安全保证.

#### 无线有线区别

有线信号限制在物理介质内,无线信号没有明显范围限制.

安全性和易用性的平衡.

针对 WLAN:

- 控制广播区域;使用WEP; 取消SSID 广播;

- 修改AP默认设置; 不使用描述性SSID;限制与MAC地址的关联;

---

### 2. 网络层

#### IP

- Spoofing
  
  - 发送定向 IP 广播数据包 （Dos）
  
  - 从一个地址或多个地址发送请求（Dos）
    
    对于不在同一网络上的主机, 攻击者不能收到回复.
  
  - 反制：流量进入网络前检查源地址.

- Sniffing

- Scanning

- ping of death (IP头部攻击, 报文重组后溢出缓冲区)

- 路由追踪 tracert

- 报文分片攻击
  
  分片报文攻击是通过向目标设备发送分片出错的报文，使得目标设备在处理分片错误的报文时崩溃、重启或消耗大量的 CPU 资源，给目标设备带来损失。

#### ARP

- ARP缓存中毒（最好归类为身份验证攻击）

- ARP广播洪泛
  
  当主机或者路由器封装帧时，若不知道目的MAC地址则会进行泛洪.

#### ICMP

- 使用icmp错误消息导致拒绝服务或将流量重定向到错误的位置
  
  - ICMP 目标不可达报文
  
  - Smurf Attack: 发送伪造源 ICMP 广播请求报文, 将流量定位到受害者.
  
  - ICMP重定向攻击: 
    
    攻击者伪装成路由器发送虚假的ICMP路由路径控制报文，使得受害主机选择攻击者指定的路由路径

- 使用traceroute 确定网络架构：Cheops-ng

#### BOOTP

- 攻击者可能试图提供虚假信息，导致主机获取错误的IP地址。（实际上是身份验证攻击）

#### DHCP

- 攻击者发送伪造的数据包,导致主机获取错误的IP地址.(Auth)

- DHCP Starvation attack
  
  攻击者保留所有IP地址

- DHCP Poisoning
  
  流氓DHCP服务器连接到网络并向合法客户端提供错误的IP配置参数

- 由于协议缓慢，洪泛攻击效果不好.

- 数据包无秘密信息, sniffing 不是安全问题.

#### 通用反制

- IP Filtering  
  
  根据IP地址，端口数，协议类型

- Network Address Translation (NAT)  
  
  拓展IP 地址空间
  
  - 静态：1 to 1 ip map
  
  - 动态 ：多对1 ip map. 
    
    - Port mapping

- Virtual Private Network (VPN)  
  
  在网络上具有指定主机（VPN服务器）
  
  外部计算机必须通过VPN服务器才能通过身份验证到达专用网络内部的主机.
  
  VPN服务器暴露在外部，内部计算机仍然通过防火墙或保留的IP地址受到保护。

- Encrypted IPV4 & IPV6 (IPSec)
  
  - 机密性–通过加密数据
  
  - 完整性–隧道两端的路由器计算数据的校验和或哈希值
  
  - 身份验证–签名和证书
  
  - 同时仍然保持通过现有IP网络进行路由的能力
  
  - 类别
    
    - Transport Mode  
      
      - IPsec头插入到IP数据包中
      
      - 没有创建新的数据包
      
      - 在增加数据包大小可能导致问题的网络中工作良好
      
      - 经常用于远程访问VPN
    
    - Tunnel Mode
      
      - 整个IP数据包经过加密，成为新的（更大的）IP数据包的数据组件
      
      - 经常在IPsec site to site VPN中使用

---

### 3. 传输层

#### TCP

- 探测攻击

- 端口扫描
  
  - connect() scan
    
    试图与服务器的65535个端口建立TCP连接, 三次握手成功则服务可用. 无需root, 但 very noisy+耗时.
  
  - TCP SYN Scanning (half-open scanning): 
    
    1. 攻击者发送SYN包.
    
    2. 如果服务器使用SYN/ACK数据包进行应答，则端口打开；如果端口关闭，则（通常）使用RST数据包.
    
    3. 攻击者发送RST报文, 结束未创建的连接.
  
  - TCP FIN Scanning
    
    攻击者发送 FIN 数据包.
    
    在大多数TCP/IP实现中: 如果端口关闭，则发送回RST数据包; 如果端口打开，则忽略FIN数据包.
    
    Windows下任意情况都回发RST报文，无法区分.

- OS 指纹

- SYN flood
  
  使用随机IP和随机端口，不断地向服务器发送大量的SYN数据包.
  
  服务器向随机地址回复报文 (DOS).
  
  消耗服务器资源.

- Reset Packets
  
  终止连接可以使用四次挥手(温和) 或 RST标志报文(强制).

- TCP Reset Attack
  
  Spoofed RST Packet, 需要知道 源ip:port 目的ip:port  Seq

- Sniffing
  
  读取报文中ip, port, seq, ack

- 会话劫持
  
  - TCP
  
  - RST：使用RST关闭客户端连接, 主动和服务器继续连接.

#### UDP

客户端不指定端口，随机选取. 服务器端指定端口.

认证问题与TCP一致. sniffing 不重要.

缓解措施：大多数组织阻止除端口53（DNS）以外的所有UDP

- UDP端口扫描
  
  向每个端口发送一个零长度UDP数据包.
  
  如果收到ICMP错误消息“端口不可达”，则认为服务不可用.

- Fraggle Attack
  
  放大攻击, 用以 DOS 攻击.
  
  攻击者用伪装的 IP 地址向服务器特定端口发送 UDP 流量，服务器产生大量应答报文，导致受害网络的阻塞或受害主机的崩溃

#### DNS

- DNS Cache Poisoning (DNS Spoofing)
  
  是一种网络攻击，通过将互联网流量从合法服务器转移到虚假服务器，利用域名系统(DNS) 中的漏洞。

- The Kaminsky Attack

- DNS Amplification (DRDoS Attack)
  
  伪造源地址查询一个响应较大的域名, 令DNS服务器向受害主机发送报文.

#### 防御

- DNSSEC
  
  确保DNS记录的真实性和完整性
  
  安全性的链式依赖.

- TLS/SSL
  
  针对其攻击:
  
  - HTTPS重定向到HTTP
  
  - 启动HTTPS会话时的MitM攻击
  
  - 心脏出血过读攻击.

---

### 4. 应用层

---

### 5. email

#### SMTP

#### POP

- Sniffing
  
  以明文形式存储用户名口令,

#### IMAP

#### MIME

#### 安全问题

- 钓鱼
  
  社工, 攻击者欺骗人们泄露敏感信息或安装勒索软件等恶意软件.
  
  受害者收到带有虚假网站链接的电子邮件并点击链接,受害者输入机密数据, 攻击者滥用输入的数据.
  
  成本低, 发送人未通过身份验证，指向虚假网站的超链接可以隐藏在HTML邮件中.

- 隐私泄露
  
  跟踪电子邮件收件人

- 垃圾邮件
  
  - 发送大量电子邮件非常简单且便宜
  
  - 发件人地址未通过身份验证
  
  - 发件人域未通过身份认证
  
  - 开放中继服务器接受并转发

- 恶意软件

#### 防御措施

- 加密与认证
  
  **PGP  Encryption** (数字信封)
  
  SMTP Security

- Email filter
  
  基于电子邮件地址, 域地址, 恶意负载进行过滤, 进行阻止、传递或修改电子邮件操作.
  
  Filtering list: 黑名单可以更换域名绕过, 白名单过于严格.

- 内容过滤
  
  利用学习来决定什么内容是垃圾邮件.某些用户代理支持垃圾邮件检测，并将垃圾邮件移动到垃圾邮件文件夹中
  
  绕过:
  
  - 关键词拼写错误 
  
  - 仅图片
  
  - 带有背景词的图片
  
  - 加密–有加密病毒
  
  - 压缩

- **电子邮件取证**

---

### 6.安全设施

#### 防火墙 Firewall

将网络的受信任组件和不受信任组件分开.

主要功能包括过滤数据、重定向流量和防止网络攻击.

设计目标: 

- 从内部到外部的所有流量都必须通过防火墙

- 只有授权流量（由本地安全策略定义）才能通过

- 防火墙本身应该不受渗透的影响（使用具有安全操作系统的可信系统）

防火墙存在于多个层次(网络层+应用层), 越高安全性越高.

#### 入侵检测系统 IDS

设计目标:

- 挫败攻击

- 进行取证调查

- 最大限度地减少损失

- 了解如何进行攻击并提高系统安全性

---

## 原理分类

### 1. 基于头部

spoofing

### 2. 基于协议

构建无效的包或设置未规定参数的包

### 3. 基于流量

无线网/本地以太网嗅探

洪泛/DOS/流量放大

### 4. 身份认证

spoofing

MITM

---

## 效果分类

### 5. DOS

- 无效报文头.

- IP报文分片攻击

- 无线网 jamming

- ping of death.

- ICMP错误信息.

- TCP RST attack 终止连接.

- DHCP starvation

### 6. Flood

- 以太广播包

- ARP请求雪崩: 向目的网络路由器发送所有可能的IP的ARP请求报文,路由器会尝试四次.

- ARP广播洪泛: 

- IP广播包

- 多地址发送 IP 请求. 

- Smurf Attack: 发送广播ICMP请求报文,将流量定位到受害者.

- TCP Syn Flood.

- TCP SYN-ACK Flood

- TCP Fin Flood.

- TCP FIN/RST Flood

- UDP Fraggle Attack

- DNS Amplification (DRDoS Attack)

### 7. 探查

- ip扫描

- 端口扫描

- 确定网络拓扑结构 traceroute

- 无线网/本地网络嗅探

### 8. 欺骗类

- Eth spoofing

- ARP cache poision => MITM

- IP spoofing

- ICMP redirect.        

- DHCP poision

- DNS cache poision

- 伪造电子邮件

- TCP 会话劫持
