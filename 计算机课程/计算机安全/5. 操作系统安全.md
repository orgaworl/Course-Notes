---
tags:
  - 计算机安全
---

---
## 1. 操作系统

**操作系统层次**

![[Pasted image 20240619170718.png|500]]

- 应用：用户具体的应用，它一般依赖具体的服务，也有可能直接构建于操作系统之上
- 服务：在操作系统之上为应用提供的通用功能（如数据库管理、网络通信等）
- 操作系统：执行资源管理（如文件管理、内存管理、外设管理等）
- 操作系统内核：对硬件进行管理的软件，其主要功能是协调处理器对内存的访问
- 硬件:包括处理器、内存等物理部件，用于存储和处理计算机系统拥有的数据

**操作系统定义**
操作系统是计算机系统中的一个系统软件，是程序模块的集合。

操作系统的作用：
- 以尽量有效、合理的方式组织和管理计算机软硬件资源
- 合理地组织计算机的工作流程
- 控制程序的执行并向用户提供各种服务功能
- 使得用户能够灵活、方便、有效地使用计算机
- 使整个计算机系统能高效地运行

操作系统功能：
- 进程和线程管理(CPU管理)
- 存储管理
- 文件管理
- 设备管理
- 任务管理
此外，操作系统为用户提供一组功能强大的、方便易用的命令或系统调用（API）


**操作系统的安全**
- 安全操作系统：试图设计和开发一个安全的操作系统
- 操作系统安全加固：对已有的操作系统进行安全性设置和配置

安全操作系统是最终目标，但是实际应用中安全性极高的操作系统还少见。

---
## 2. 操作系统安全模型

### 基本模型
- 安全模型定义进程（主体）对特定资源（对象）可以进行何种类型的访问。
- 使用模型时，首先必须确保主体在访问资源前通过了认证（Authentication）
- 用户认证后，依据访问控制策略（Access Control Policy）给予用户访问资源的授权
- 操作系统也需要对用户的认证（Authentication）、授权（Authorization）、访问（Access）等操作进行日志记录（Logging）和审计（Audit）

![[Pasted image 20240528112857.png]]

### **引用监视器**
- 是一种访问控制，用于协调主体对客体的访问

![[Pasted image 20240528113219.png]]

### **安全内核** 
实现引用监视器概念的可信计算基的硬件、固件和软件的集合体，是系统中与安全性的实现有关的部分

- 可信计算基（TCB：Trusted Computing Base）：
	- 是一个计算机系统中的全部保护机制（包括硬件、固件和软件），他们结合起来为系统提供全局统一的访问控制策略。
	- 在某些系统中，TCB等同于安全内核，即TCB是操作系统的一部分，是整个系统安全性的基础。

- 安全内核的要求：
	- 必须对所有访问进行验证和授权；
	- 自身必须被保护不被修改；
	- 自身的安全性应是可证且安全的。

- 安全内核包括
	- 引用验证机制
	- 授权机制
	- 授权管理机制等

- 引用验证机制 3 个原则：
	- 必须具有自我保护能力；
	- 必须总是处于活跃状态；
	- 必须设计得足够小，以利于分析和测试，从而能够证明它的实现是正确的。

- 操作系统相关的主要安全机制包括：
	- 身份认证技术
	- 访问控制技术
	- 文件保护技术
	- 内存保护技术
	- 恶意程序防御技术

---
## 3. 文件保护

- 安全防护需求:
	- 存储在磁盘上的文件往往是攻击者的攻击对象
	- 对于多用户操作系统，操作系统必须提供文件保护机制：
		- 防止用户有意或无意的对系统文件、用户文件或其他数据文件进行非法存取或修改
		- 多用户操作系统中用户数越多，安全保护也更复杂
	- 文件具有易毁性（随机性、虚拟性、电磁性、可覆盖性），更需要保护


- 文件保护机制划分
	- 对文件本身的安全保护
		- 机密：访问控制，加密
		- 完整：加密，加壳，混淆，可信计算基
		- 可用：分片，备份  
	- 对文件所在文件系统的安全保护
		- 文件访问控制服务（如Windows和UNIX的ACL）
		- 对文件系统加密（如Windows NTFS提供的加密功能）
		- 对文件系统备份（如Windows和UNIX提供的备份与恢复功能）
	- 对文件存储载体的安全保护
		- 加密（如硬盘加密、加密U盘）
		- 冗余（如磁盘阵列、双机备份））
		- 抗毁
		- 防盗
		- 防电磁泄露


- 文件保护等级
	1. 一般性有无保护
		- 基于系统中用户都是可信的原则
		- 对特定文件或者机密文件进行口令访问保护
	2. 分组保护
		- 根据用户特征，将具有相同特征的用户归为一组，并为组定义对文件的存取权限
		- 每个用户属于一个组（不能属于多个组）
	3. 单独保护许可保护
		- 对单个文件进行存取权限保护（如访问控制）


---
## 4. 内存保护

- 内存保护需求
	- 操作系统基本上都支持多道程序技术
		- 很多程序同时共存于内存中，彼此互不影响，并有可能非法获取其他程序的数据
	- 堆栈访问技术
		- 地址增长与主存地址增长不同，有可能导致堆栈溢出
	- 区域保护技术
		- 操作系统与用户运行区域分开与保护，确保用户程序无法获取操作系统内核中的数据


- 操作系统在内存中的数据结构
	- PCB/DTB表格（存放内存数据信息）
	- 参数数据区
	- 中断矢量
	- 驱动程序
	- 共享程序
	- ……

- 可能的安全攻击
	- 内存映象窃取 (将内存中某一块映射到文件中)
	- 缓冲区内容截取 (获取机密信息)
	- 内存跟踪技术 (获取程序执行顺序)
	- 存储内容分析技术(获取机密信息)
	- 存储器锁定技术(获取机密信息)
	- 扩展存储器使用技术(获取机密信息)

- 内存保护方法
	- 硬件保护：如ECC，CPU运行模式，RAM分区
	- 操作系统内核保护：
		- 界址（Fence）
		- 界址寄存器（Bound Register）
		- 重定位
		- 特征位
		- 分段
		- 分页
		- 虚拟机制



---
## 5. UNIX操作系统安全

### 基础知识
UNIX操作系统有各种版本
- SunOS、Solaris、AIX、HP-UX
- 类UNIX操作系统： Linux、FreeBSD

- 早期的UNIX操作系统基于相互信任的环境
	- 并不采用强制访问控制机制
	- UNIX系统中的超级用户拥有超级权限，往往成为问题的根源

- 后期UNIX操作系统提供了不等级别的安全保护
	- 常规UNIX：C1级
	- OSF/1：B1级
	- USL的SVR4/ES：B2级


- UNIX文件系统的安全机制包括：
	- 硬件安全保护（如段保护等）
	- 用户及口令管理（身份认证）
		- 单个用户及口令管理
		- 组及口令管理
		- 超级用户及口令管理
	- 文件权限管理（访问控制）

![[Pasted image 20240531221401.png]]

- UNIX 常用日志文件
	- usr/adm  早期版本的UNIX
	- /var/adm  较新版本的UNIX
	- /var/log  用于Solaris,Linix,BSD
	- /etc  UNIX system V 早期版本

### UNIX 账号和口令管理

- 系统用户与口令
	- 每个用户拥有唯一的 16 位数字用户标识UID
	- **UNIX口令文件** `/etc/passwd` 保存UID对应的口令,加密口令用`*`表示
		- `userName:x:UID:GID:comment:HomeDir:ShellDir`,x为空表示无口令，否则口令密文保存在`/etc/shadow`中
		- 文件etc/passwd是任何用户均可读
	- 实际上，口令经DES加密后保存在安全目录`/etc/shadow`下
		-  `userName:$algNum$salt$passwdCipher:modifyTime:...`
		- 受安全保护的口令文件只能由具有系统管理员权限的用户或超级用户可读
	- UID是用户在操作系统合法性及拥有相应权限的唯一凭证
	- UNIX 对权限的管理是依据 UID：具有相同 UID 的用户具有相同权限
	- UID为0的用户是系统的超级用户，拥有一切权限
	- UNIX对权限的管理是依据UID：具有相同UID的用户具有相同权限

- 用户与组
	- UNIX系统中的所有用户都必须属于某个组（group）
	- 同组的所有用户具有相同的权限
	- 用户与组之间的关系可以在文件`/etc/group`中查看，文件格式是：
		`group name:group password:GID:users`
	

### UNIX 权限管理

- 目录文件权限
	- 读取(r:read) 查找目录中的文件和子目录
	- 写(w:write) 从目录中删除和修改文件和子目录
	- 执行(x: execute) 进入相应的目录

- 文件初始权限管理
	- 文件和目录的初始权限是由创建者的用户掩码(umask)来确定的
	- umask 为9位二进制数,  初始权限=默认权限-掩码.
	- 文件默认权限 666，目录默认权限 777
	- 即umask表示**不应拥有的权限**


粘滞位: 允许用户执行那些只有超级用户或者管理者才有读写权限的程序或者命令
- set-user-id（SUID）：如果设定了该权限，当文件被执行时，将**以文件的拥有者**的身份执行，而不是普通用户的身份；该权限对于不可执行的文件或目录无效。
	`chmod u+s file`
- set-group-id（SGID）：与set-user-id相同，当文件被执行时，将**以文件的组**的身份来执行，而不是一般的用户身份。
	`chmod g+s file`
- sticky（S）：如果对目录设置该权限，该目录可以被其他用户读写，但该目录下的文件和目录只有拥有者才有权删除或更名。
	`chmod +t file`

- 只给文件赋予s权限，系统是不会自动让该文件具备可执行权限的
	- `s` 表示既有可执行权限，又有s权限
	- `S`表示有s权限，但没有可执行权限
---
## 6. Windows 操作系统安全

### 安全模型

- 工作群组（Workgroup）模型
	- 工作群组模型适合于小型网络，具有相同工作组名称的各工作站可以参与同一个工作群组。
	- 各工作站自行维护各自的账号及安全策略数据库。
	- 工作群组成员之间可共享某些资源。
	- 由于资源管理必须在各工作站上设定，因此对于大规模网络很难实施统一的管理。


- 网络域（Domain）模型
	- 网络域模型适合于大中型网络。
	- 与工作群组模型的分布式资源管理方式，网络域模型采用集中式管理
		- 在网域模型里，由一个主域控制器（Primary domain controller：PDC）负责储存所管辖网络域内的共享账号数据及安全策略数据库
		- 每个工作站必须通过主域控制器的认证后，才能存取域内的资源
		- 域的管理员只需要对网络主控台进行管理，就可以控制各用户的访问权限
	
	- 通过跨域认证和信任，扩大资源共享范围，从而使网络域模型适合于大型网络环境。

### 安全模型组成

Windows  NT的安全模型
Windows  NT包括一组构成Windows  安全模型的安全组件。

这些组件确保了应用程序不能在没有身份验证和授权的情况下对资源进行访问。

这些安全组件称为Windows的安全子系统（Windows  Security Subsystem），是Windows NT系统中安全机制的最重要核心

- 安全子系统的组件在本地安全管理员进程（lsass.exe）的上下文中运行，主要包括以下组件：
	- Winlogon
	- Graphical  Identification  and  Authentication DLL  (GINA)
	- Local  Security Authority (LSA)
	- Security  Support  Provider  Interface  (SSPI)
	- Authentication Packages （AP）
	- Security Support Providers (SSP)
	- Netlogon  service（Netlogon）
	- Security Account Manager (SAM)


![[Pasted image 20240619174832.png|625]]

#### （1）windows登录（Winlogon）：

- Winlogon调用GINA DLL，并监视安全警告序(Secure Attention Sequence：SAS)
	- SAS是一组组合键，默认情况下为Ctrl-Alt-Delete
	- 它的作用是确保用户交互式登录时输入的信息被系统所接受，而不会被其他程序所获取

- 因此，使用“安全登录”进行登录，可以确保用户的帐号和密码不会被攻击者盗取

- Winlogon启动时，在注册表中查找以下键值：
	- \HKLM\Software\Microsoft\Windows  NT\CurrentVersion\Winlogon
	- 如果存在GinaDLL键，Winlogon将使用这个DLL
	- 如果不存在该键，Winlogon将使用默认值MSGINA.DLL

#### （2）界面识别与认证（Graphical Identification and Authentication：GINA）动态链接库

- GINA提供一个交互式的界面为用户登录提供认证请求

- GINA  被设计成一个独立的模块

- 开发人员也可以用一个更加强有力的认证方式（指纹、视网膜）替换内置的GINA DLL


#### （3）本地安全管理员（Local Security Authority：LSA）

- LSA是Windows  NT安全系统的核心功能模块，它的主要功能是检查用户登录信息，并依据安全策略为用户生成系统访问令牌（SAT：System Access Token）。

- 它负责以下任务：

	- 调用所有的认证包：检查在注册表\HKLM\SYSTEM\CurrentControlSet\Control\LSA下 AuthenticationPAckages下的值，并调用该DLL进行认证（MSV_1.DLL）。在4.0版里，Windows NT会寻找\SYSTEM\CurrentControlSet\Control\LSA 下所有存在的SecurityPackages值并调用。
	- 重新找回本地组的SIDs和用户的权限。
	- 创建用户的访问令牌。
	- 管理本地安装的服务所使用的服务账号。
	- 储存和映射用户权限。
	- 管理审核的策略和设置。
	- 管理信任关系。

### 口令与管理

### 认证和访问控制

### NTFS文件系统


### 防火墙
- 防火墙是系统安全的最后一道屏障
- 在杀毒软件被攻破后，有效设置过的防火墙能够阻止病毒/木马建立远程连接传输屏幕信息和隐私文件


---
## 7.操作系统安全加固

操作系统加固（OS Hardening）也叫主机加固（host Hardening），是通过执行操作系统或应用程序的典型安装或缺省安装，然后进行一定修改，从而减少潜在 漏洞，增强被保护目标的安全性。

- 操作系统是最难以控制的安全因素：软件日益庞大/功能和服务众多，以及安全漏洞层出不穷
- 操作系统加固的结果是受保护目标拥有了一个安全的平台，该平台不依赖于外在的安全机制
- 操作系统加固是纵深防御（Defense In-Depth）的最后一道防线，攻击者一旦突破主机，则将直接面对真正的攻击目标

常用的操作系统加固技术包括：
- 安全操作系统技术 (使用安全性高的系统)
- 应用开发安全技术（避免使用有缓冲区溢出风险的函数）
- 代码安全技术（对源代码或二进制代码进行安全检测）
- 反病毒软件技术
- 防火墙技术
- 入侵检测技术
- 蜜罐技术(将攻击引向特定位置，以便监控和分析)

典型的操作系统安全加固分为：
- 防止本地攻击的安全加固
- 抵御网络攻击的安全加固
- 抵御应用程序攻击的安全加固

### 防止本地攻击的安全加固

- 防止本地攻击的安全加固的内容：
	- 限制管理工具的使用
	- 使用文件系统的访问控制来保护用户
	- 管理用户
	- 安全日志记录
- 其中限制管理工具的使用主要是限制和监控那些功能强大的管理工具的使用情况。


### 抵御网络攻击的安全加固

- 抵御网络攻击的安全加固的内容：
	- 删除不必要的帐号
	- 使用健壮的口令
	- 停止未使用的网络服务
	- 禁用资源共享（windows）
	- 禁用远程访问服务（UNIX）

- 其中，对于UNIX操作系统，停止未使用的网络服务可以使用以下工具：
	- Netstat–na：查看网关状态 
	- ps–ef：查看进程列表
	- Kill  -9：强制终止进程




---
Author : orgaworl@outlook.com
Github : [orgaworl/Course-Notes: SDU CyberScience (github.com)](https://github.com/orgaworl/Course-Notes)
Create: `2024-05-28` `11:15`
